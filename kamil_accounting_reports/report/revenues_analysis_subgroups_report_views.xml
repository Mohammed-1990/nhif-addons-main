<?xml version="1.0" encoding="utf-8" ?>
<odoo>
	
	<!-- Revenues Analysis subgroups Report-->
	<report 
		id="rev_analysis_sub_report"
		model="wiz.revenues.analysis.subgroups"
		string="Revenues Analysis subgroups Report"
		report_type="qweb-html"
		name="kamil_accounting_reports.rev_analysis_sub_temp"
		paperformat="kamil_accounting_reports.paperformat_a3_landscape"
	/>


	<!-- Revenues Analysis Subgroup Report Template-->
	<template id="rev_analysis_sub_temp">
			<t t-call="web.html_container">
                <div class="page">
                    <div class="text-center">
					<img t-if="company_id_logo" t-att-src="image_data_uri(company_id_logo)" class="img-fluid oe_slides_channel_thumbnail" alt="Logo"/>
					</div>
					<br/><br/>
                    <div dir="rtl" style="float:right;text-align:start;">
                        <a href="#" target="_blank">
                            <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-printer" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 2H5a1 1 0 0 0-1 1v2H3V3a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2h-1V3a1 1 0 0 0-1-1zm3 4H2a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h1v1H2a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1z"/>
                                <path fill-rule="evenodd" d="M11 9H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1zM5 8a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H5z"/>
                                <path d="M3 7.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/>
                            </svg>
                        </a>
                    </div>
                    <br/>
                    



					<div class="text-center" >
                        <strong>
                           <p>

							<b>نموذج تحليل مفردات الايرادات</b>
							<br/>
							<b>
							<t t-if="date_from" >
								للفترة من
								<t t-esc="date_from"/>
							</t>

							<t t-if="date_to" >
								الى
								<t t-esc="date_to"/>
							</t>
							</b>
						
                            </p>
                        </strong>
                    </div>
                    
                    <table style="margin:10px;width:100%;" dir="rtl" class="table-bordered">
                        <thead style="display: table-header-group;">
                            <tr class="table-active">

                                <td class="text-center fit" rowspan="2">
									الرقم
								</td>
                                <td class="text-center fit" rowspan="2">
									التاريخ
								</td>
                                <td class="text-center fit" rowspan="2">
									البيان
								</td>
                                <td class="text-center fit" rowspan="2">
									رقم المستند
								</td>
                                <t t-foreach="all_accounts" t-as="account">
                                    <t t-if="account.id in column_keys">
                                        <td class="text-center fit" colspan="2">
                                            <t t-esc="account['name']" />
                                        </td>
                                    </t>
                                </t>
                                <td class="text-center fit" colspan="2">
									الاجمالي
								</td>
                            </tr>
                            <tr>
                                <t t-foreach="all_accounts" t-as="account">
                                    <t t-if="account.id in column_keys">
                                        <td class="text-center fit">
											مدين
										</td>
                                        <td class="text-center fit">
											دائن
										</td>
                                    </t>
                                </t>
                                <td class="text-center fit">
									مدين
								</td>
                                <td class="text-center fit">
									دائن
								</td>
                            </tr>
                        </thead>
                        <tbody>

                        	<t t-set="total_debit_y" t-value="0"/>
   							<t t-set="total_credit_y" t-value="0"/>

                            <t t-set="count" t-value="1" />
                            <t t-foreach="net_moves_data" t-as="move_row">
                            	
                            	<t t-set="total_debit_x" t-value="0"/>
   								<t t-set="total_credit_x" t-value="0"/>
                                
                                <tr style="page-break-inside: avoid;">
                                    <td class="text-center fit">
                                        <t t-esc="count" />
                                        <t t-set="count" t-value="count + 1" />
                                    </td>
                                    <td class="text-right fit">
                                        <t class="text-right fit" t-esc="net_moves_data[move_row]['date']" />
                                    </td>
                                    <td class="text-right fit">
                                        <t t-esc="net_moves_data[move_row]['name']" />
                                    </td>
                                    <td class="text-right fit">
                                        <t t-esc="net_moves_data[move_row]['document_number']" />
                                    </td>
   	
   	

    <t t-foreach="all_accounts" t-as="account">
        <t t-if="account.id in column_keys">
            <td class="text-right fit">
                <t t-if="all_data[net_moves_data[move_row]['move_id']].get(account.id , False)">

                    <t t-esc="all_data[net_moves_data[move_row]['move_id']][account.id]['str_debit'] " />
                    
                    <t t-set="total_debit_x" t-value="total_debit_x + all_data[net_moves_data[move_row]['move_id']][account.id]['debit']"/>

                </t>
            </td>
            <td class="text-right fit">
                <t t-if="all_data[net_moves_data[move_row]['move_id']].get(account.id , False)">
                    <t class="text-right fit" t-esc="all_data[net_moves_data[move_row]['move_id']][account.id]['str_credit'] " />
                   
                    <t t-set="total_credit_x" t-value="total_credit_x + all_data[net_moves_data[move_row]['move_id']][account.id]['credit']"/>
                </t>
            </td>
        </t>
    </t>

    <td class="text-center fit">
    	<t t-esc="'{:,.2f}'.format( total_debit_x )"/>
    </td>
    <td class="text-center fit">
    	<t t-esc="'{:,.2f}'.format( total_credit_x )"/> 
    </td>

    <t t-set="total_debit_y" t-value="total_debit_y + total_debit_x"/>
    <t t-set="total_credit_y" t-value="total_credit_y + total_credit_x"/>
    


                                </tr>
                            </t>
                        
                        <tr class="table-active">
                            <td class="text-center fit" colspan="4">
                            	<strong>
									الاجمالي
								</strong>
							</td>

							<t t-foreach="all_accounts" t-as="account">
								<t t-if="account.id in column_keys">
									<t t-foreach="accounts_total" t-as="account_total">
										<t t-if="account_total == account.id">
											<td class="text-center fit"> 
												<t t-esc="'{:,.2f}'.format( accounts_total[account_total]['debit'] )"/>
											</td>	
											 <td class="text-center fit">
												<t t-esc="'{:,.2f}'.format( accounts_total[account_total]['credit'] )"/>
											</td>	
										</t>

									</t>

								</t>
							</t>


							<td class="text-center fit">
								<t t-esc="'{:,.2f}'.format( total_debit_y )"/>
							</td>
							<td class="text-center fit">
								<t t-esc="'{:,.2f}'.format( total_credit_y )"/>
							</td>

                        </tr>
                        </tbody>
                    </table>

                </div>
			</t>
	</template>


</odoo>