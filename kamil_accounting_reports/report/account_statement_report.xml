<?xml version="1.0" encoding="utf-8"?>
<odoo>

	<!-- Payment Report-->
	<report id="account_statement_report" model="account.statement.wizard" string="Account Statement Report" report_type="qweb-html" name="kamil_accounting_reports.statement_template" />


	<!-- Payment Report Template-->
	<template id="statement_template">
		<t t-call="web.html_container">
					<div class="page">
					<div class="text-center">
					<img t-if="company_id_logo" t-att-src="image_data_uri(company_id_logo)" class="img-fluid oe_slides_channel_thumbnail" alt="Logo"/>
				</div>
				<br/><br/>
					<div class="text-center" style="font:900;">
						<strong>
							<p>
								<t t-if="type == 'account_statment'">
									تقرير كشف حساب
									<br />
								</t>

								<t t-if="type == 'account_group'">
									تقرير كشف مجموعة
									<br />
								</t>
								<b>
									<t t-if="date_from">
										للفترة من
										<t t-esc="date_from" />
									</t>

									<t t-if="date_to">
										الى
										<t t-esc="date_to" />
									</t>
								</b>
								<br />
								<b>
									<t t-if="partner">
										الجهه الطالبة
										<t t-esc="partner" />
									</t>
								</b>
							</p>
						</strong>
					</div>
					<br />
					<t t-if="type == 'account_statment'">
						<t t-if="is_group_by_partners">
							<t t-foreach="docs" t-as="line">
								<div>
									<div dir="rtl" style="float:right;text-align:start;">
										<b>إسم الحساب </b>
										<t t-esc="line['account_name']" />
										<br />
									</div>
									<br />
									<br />
									<table dir="rtl" border="1" class="text-center table">
										<thead style="display: table-header-group;">
											<tr class="table-active">
												<td class="text-center fit">
													م.
												</td>

												<td class="text-center fit">
													الجهة
												</td>

												<td class="text-center fit">
													الرصيد الافتتاحي
												</td>
												<td class="text-center fit">
													المدين
												</td>
												<td class="text-center fit">
													الدائن
												</td>
												<td class="text-center fit">
													الرصيد
												</td>
											</tr>
										</thead>
										<tbody>
											<t t-foreach="line['vals']" t-as="vals">
												<tr style="page-break-inside: avoid;">
													<td class="text-right">
														<t t-esc="vals_index + 1" />
													</td>
													<td class="text-right fit">
														<t t-esc="vals['partner_name']" />
													</td>
													<td class="text-right fit">
														<t t-esc="vals['opening_balance']" />
													</td>

													<td class="text-right fit">
														<t t-esc="'{0:,.2f}'.format(float(vals['total_debit']))" />
													</td>

													<td class="text-right fit">
														<t t-esc="'{0:,.2f}'.format(float(vals['total_credit']))" />
													</td>

													<td class="text-right fit">
														<t t-esc="vals['balance']" />
													</td>
												</tr>
											</t>
											<tr class="table-active">
												<td class="text-center fit" colspan="2">
													<b>الاجمالي</b>
												</td>
												<td class="text-center">
													<t t-esc="line['total_opening_balance']" />
												</td>
												<td class="text-center">
													<t t-esc="line['total_total_debit']" />
												</td>
												<td class="text-center">
													<t t-esc="line['total_total_credit']" />
												</td>
												<td class="text-center">
													<t t-esc="line['total_balance']" />
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</t>
						</t>


						<t t-if="not is_group_by_partners">
							<t t-foreach="docs" t-as="line">
								<div dir="rtl" style="float:right;text-align:start;">
									<div>
										<b>إسم الحساب </b>
										<t t-esc="line['account_name']" />
										<br />


										<t t-if="account_type == 'expenses'">
											<b>المبلغ المصدق </b>
											<t t-esc="line['opening_balance_type']" />
										</t>


										<t t-if="account_type == 'revenues'">
											<b>الربط المقدر </b>
											<t t-esc="line['opening_balance_type']" />
										</t>


										<t t-if="account_type == 'assets' or account_type == 'liabilities'">
											<b> الرصيد الافتتاحي </b>
											<t t-esc="line['opening_balance_type']" />
										</t>
										<br />

										<t t-if="partner_name">
											<b> الجهة </b>
											<t t-esc="partner_name" />
										</t>
									</div>
									<br/>
								</div>
								<br />
								<br />
								<table style="margin:10px;width:100%;" dir="rtl" class="table-bordered">
									<thead>
										<tr style="page-break-inside: avoid;" class="table-active">
											<td class="text-center" style="width:5%;">م.</td>
											<td class="text-center fit" style="width:13%;">التاريخ</td>
											<td class="text-center fit"> نوع المستند </td>
											<td class="text-center fit" style="width:15%;">رقم المستند</td>

											<t t-if="not partner_name and report_type == 'group_by_account' ">
												<td class="text-center fit">الجهة</td>
											</t>

											<td class="text-center fit">المدين</td>
											<td class="text-center fit">الدائن</td>
											<td class="text-center">البيان</td>
										</tr>

									</thead>
									<tbody>
										<t t-foreach="line['vals']" t-as="vals">
											<tr style="page-break-inside: avoid;">
												<td class="text-center">
													<t t-esc="vals_index + 1" />
												</td>
												<td class="text-right">
													<t t-esc="vals['date']" />
												</td>
												<td class="text-right fit">
													<t t-esc="vals['doc_type']" />
												</td>
												<td class="text-right fit">
													<t t-esc="vals['ref']" />
												</td>

												<t t-if="not partner_name  and report_type == 'group_by_account' ">
													<td class="text-right fit">
														<t t-esc="vals['the_partner_name']" />
													</td>
												</t>


												<td class="text-right fit">
													<t t-esc="'{0:,.2f}'.format(float(vals['debit']))" />
												</td>
												<td class="text-right fit">
													<t t-esc="'{0:,.2f}'.format(float(vals['credit']))" />
												</td>
												<td class="text-right">
													<t t-esc="vals['description']" />
												</td>
											</tr>

										</t>
										<tr>
											<t t-if="not partner_name">
												<td class="text-center" colspan="4">
													<b>الاجمالي</b>
												</td>
											</t>


											<t class="text-center" t-if="partner_name">
												<td colspan="4">
													<b>الاجمالي</b>
												</td>
											</t>


											<td style="padding:5px;">
												<t class="text-center" t-esc="'{0:,.2f}'.format(float(sum([p['debit'] for p in line['vals']])))" />
											</td>
											<td class="text-center" style="padding:5px;">
												<t t-esc="'{0:,.2f}'.format(float(sum([p['credit'] for p in line['vals']])))" />
											</td>
											<td></td>
										</tr>
										<t t-if="account_type == 'revenues' or account_type == 'expenses'">
											<tr>
												<td class="text-center" colspan="5">
													<b>صافي المدة</b>
												</td>
												<td class="text-center" colspan="2">

													<t t-esc="line['net_term_type']" />

													<br />
												</td>
											</tr>
										</t>


										<t t-if="account_type == 'assets' or account_type == 'liabilities'">

											<tr>
												<t t-if="not partner_name">
													<td class="text-center" colspan="5">
														<b>صافي المدة</b>
													</td>
												</t>
												<t t-if="partner_name">
													<td class="text-center" colspan="5">
														<b>صافي المدة</b>
													</td>
												</t>

												<td class="text-center" colspan="3">

													<t t-if=" account_type == 'assets' ">
														<t t-set="period_net" t-value="(sum([p['debit'] for p in line['vals']])) - (sum([p['credit'] for p in line['vals']]))" />

														<t t-if="period_net &lt; 0">
															(
															<t t-esc="'{0:,.2f}'.format( float(abs(period_net) ) )" />
															)
														</t>
														<t t-if="period_net &gt; 0 or period_net == 0 ">
															<t t-esc="'{0:,.2f}'.format( float(period_net) )" />
														</t>

													</t>


													<t t-if=" account_type == 'liabilities' ">
														<t t-set="period_net" t-value="(sum([p['credit'] for p in line['vals']])) - (sum([p['debit'] for p in line['vals']]))" />

														<t t-if="period_net &lt; 0">
															(
															<t t-esc="'{0:,.2f}'.format( float(abs(period_net) ) )" />
															)
														</t>
														<t t-if="period_net &gt; 0 or period_net == 0 ">
															<t t-esc="'{0:,.2f}'.format( float(period_net) )" />
														</t>

													</t>
												</td>

											</tr>


											<tr>

												<t t-if="not partner_name">
													<td colspan="5">
														<b>الرصيد</b>
													</td>
												</t>


												<t t-if="partner_name">
													<td colspan="5">
														<b>الرصيد</b>
													</td>
												</t>

												<td colspan="3">
													<t class="text-center fit" t-esc="line['net_term_type']" />
												</td>
											</tr>

										</t>


									</tbody>
								</table>

							</t>
						</t>
					</t>

					<t t-if="type == 'account_group'">
						<div dir="rtl" style="font-family:Calibri;" class="text-right">
							<b>إسم المجموعة 
							</b>
							<t t-esc="docs[0]['group_name']" />
							<br />
							<t t-if="partner_name">
								<b> الجهة </b>
								<t t-esc="partner_name" />
							</t>
						</div>

						<table style="margin:10px;width:100%;" dir="rtl" class="table-bordered">
							<tbody>
								<tr style="page-break-inside: avoid;" class="table-active">
									<td class="text-center fit">م.</td>
									<td class="text-center fit">إسم المجموعة</td>
									<td class="text-center fit"> الرصيد الإفتتاحي </td>
									<td class="text-center fit">المدين</td>
									<td class="text-center fit">الدائن</td>
									<td class="text-center fit">الرصيد</td>
								</tr>


								<t t-set="last_total" t-value="0" />

								<t t-set="line_count" t-value="1"/>
								<t t-foreach="docs[0]['group_list']" t-as="l">

									<t t-foreach="l['vals']" t-as="line">
										<tr style="page-break-inside: avoid;">

											
											<td class="text-center fit">
												<t t-esc="line_count" />
												<t t-set="line_count" t-value="line_count + 1"/>
											</td>
											<td class="text-right fit">
												<t t-esc="line['account_name']" />
											</td>
											<td class="text-right fit">
												<t t-esc="'{0:,.2f}'.format(float(line['the_opening_balance']))" />
											</td>

											<td class="text-right fit">
												<t t-esc="'{0:,.2f}'.format(float(line['debit']))" />
											</td>
											<td class="text-right fit">
												<t t-esc="'{0:,.2f}'.format(float(line['credit']))" />
											</td>

											<td class="text-right fit">
												<t t-esc="'{0:,.2f}'.format(float(line['balance']))" />
											</td>
										</tr>

									</t>

									<t t-set="last_total" t-value=" last_total + sum([p['balance'] for p in l['vals']]) " />

								</t>

								<tr class="table-active">
									<td colspan="3" class="text-center fit">
										<b>الاجمالي</b>
									</td>
									<td colspan="3" class="text-center fit">
										<t t-esc="'{0:,.2f}'.format(float(last_total))" />
									</td>

								</tr>


							</tbody>
						</table>
					</t>
				</div>
			</t>
	</template>


</odoo>